---
import FilterChip from "@components/FilterChip.astro";
import { colors } from "./utils/colors";

interface CategoryInfo {
    name: string;
    count: number;
}

interface Props {
    categories: CategoryInfo[];
    selectedCategory?: string;
    selectedSort?: "newest" | "last-edited";
}

const { categories, selectedCategory, selectedSort = "last-edited" } =
    Astro.props;

// Calculate total notes count
const totalNotes = categories.reduce((sum, cat) => sum + cat.count, 0);

// Build URLs that preserve the current sort
const getSortSuffix = () => {
    if (selectedSort === "newest") {
        return "/newest";
    }
    return ""; // default sort doesn't need suffix
};

const sortSuffix = getSortSuffix();
const allHref =
    selectedSort === "newest" ? "/garden/sort/newest" : "/garden";
---

<div>
    <div class="mb-5 font-bold">Topics</div>
    <ul class="flex flex-row flex-wrap gap-3">
        <FilterChip
            color="black"
            title="All"
            href={allHref}
            isActive={!selectedCategory}
            count={totalNotes}
        />
        {
            categories.map((category, index) => (
                <FilterChip
                    color={colors[index % colors.length]}
                    title={category.name}
                    href={`/garden/${category.name.toLowerCase()}${sortSuffix}`}
                    isActive={selectedCategory === category.name}
                    count={category.count}
                />
            ))
        }
    </ul>
</div>
