---
import Chip from "@components/Chip.astro";
import { colors } from "./utils/colors";

interface CategoryInfo {
    name: string;
    count: number;
}

interface Props {
    categories: CategoryInfo[];
    selectedCategory?: string;
    selectedSort?: "newest" | "last-edited" | "alphabetical";
}

const {
    categories,
    selectedCategory,
    selectedSort = "last-edited",
} = Astro.props;

// Calculate total notes count
const totalNotes = categories.reduce((sum, cat) => sum + cat.count, 0);

// Build URLs that preserve the current sort
const getSortSuffix = () => {
    if (selectedSort === "newest") {
        return "/newest";
    }
    if (selectedSort === "alphabetical") {
        return "/alphabetical";
    }
    return ""; // default sort doesn't need suffix
};

const sortSuffix = getSortSuffix();
const allHref =
    selectedSort === "newest"
        ? "/garden/sort/newest"
        : selectedSort === "alphabetical"
          ? "/garden/sort/alphabetical"
          : "/garden";
---

<div>
    <div class="mb-3 font-bold">Topics</div>
    <div class="flex flex-row flex-wrap gap-3">
        <Chip
            indicator="black"
            indicatorType="dot"
            title="All"
            href={allHref}
            isActive={!selectedCategory}
            count={totalNotes}
            activeStyle="neutral"
        />
        {
            categories.map((category, index) => (
                <Chip
                    indicator={colors[index % colors.length]}
                    indicatorType="dot"
                    title={category.name}
                    href={`/garden/${category.name.toLowerCase()}${sortSuffix}`}
                    isActive={selectedCategory === category.name}
                    count={category.count}
                    activeStyle="neutral"
                />
            ))
        }
    </div>
</div>
