---
import Select from "@components/Select.astro";

interface Props {
    selectedSort: "newest" | "last-edited" | "alphabetical";
    selectedCategory?: string;
}

const { selectedSort, selectedCategory } = Astro.props;

const sortOptions = [
    { label: "Newest", value: "newest" },
    { label: "Last edited", value: "last-edited" },
    { label: "Alphabetical", value: "alphabetical" },
];
---

<div
    class="sort-filter mt-[39px]"
    data-category={selectedCategory?.toLowerCase() || ""}
>
    <Select options={sortOptions} selectedValue={selectedSort} name="sort" />
</div>

<script>
    function initSortFilter() {
        const filters = document.querySelectorAll(".sort-filter");

        filters.forEach((filter) => {
            const select = filter.querySelector("select") as HTMLSelectElement;
            if (!select) return;

            const category = (filter as HTMLElement).dataset.category;

            select.addEventListener("change", () => {
                const sort = select.value;
                const url = category
                    ? `/garden/${category}/${sort}`
                    : `/garden/sort/${sort}`;
                window.location.href = url;
            });
        });
    }

    initSortFilter();
    document.addEventListener("astro:after-swap", initSortFilter);
</script>
