---
import { Icon } from "astro-icon/components";

interface Props {
    title: string;
    description: string;
    year: string;
    slug: string;
    bgColor?: string;
    bgColorDark?: string;
    thumbnail?: string;
    thumbnailWidth?: string;
    externalUrl?: string;
    tags?: string[];
    draft?: boolean;
}

const {
    title,
    description,
    year,
    slug,
    bgColor = "#ef4444",
    bgColorDark,
    thumbnail,
    thumbnailWidth,
    externalUrl,
    tags,
    draft = false,
} = Astro.props;

const href = externalUrl || `/projects/${slug}`;
const isExternal = !!externalUrl;

const cardClasses = `project-card group h-full relative aspect-4/5 rounded-2xl p-3 flex flex-col overflow-hidden ${draft ? 'cursor-not-allowed' : 'hover-lift'}`;
---

{draft ? (
    <div
        class={cardClasses}
        style={`--bg-color: ${bgColor}; --bg-color-dark: ${bgColorDark || bgColor};`}
    >
        <div class="flex justify-between items-center shrink-0">
            <span class="rounded-full bg-neutral-100/10 px-3 py-1 text-white"
                >{year}</span
            >
            <span class="rounded-full bg-neutral-100/10 px-3 py-1 text-white text-sm">
                Coming soon
            </span>
        </div>
        <div class="thumbnail-container flex-1 flex-center">
            {
                thumbnail ? (
                    <img
                        src={thumbnail}
                        alt={title}
                        class="h-full object-contain"
                        style={
                            thumbnailWidth
                                ? `width: ${thumbnailWidth}`
                                : "width: 30%"
                        }
                    />
                ) : (
                    <span class="text-neutral-500">–</span>
                )
            }
        </div>
        <div class="shrink-0 text-white transition-transform duration-300 md:group-hover:-translate-y-6">
            <h3>{title}</h3>
            {tags && tags.length > 0 && (
                <div class="flex flex-wrap gap-1 mt-2">
                    {tags.map((tag) => (
                        <span class="text-xs bg-neutral-100/10 px-2 py-0.5 rounded-full opacity-70">
                            {tag}
                        </span>
                    ))}
                </div>
            )}
            <p class="hidden md:block max-h-0 overflow-hidden opacity-0 group-hover:max-h-24 group-hover:opacity-70 mt-2 transition-all duration-300">{description}</p>
        </div>
    </div>
) : (
    <a
        href={href}
        target={isExternal ? "_blank" : undefined}
        rel={isExternal ? "noopener noreferrer" : undefined}
        class={cardClasses}
        style={`--bg-color: ${bgColor}; --bg-color-dark: ${bgColorDark || bgColor};`}
    >
        <div class="flex justify-between items-center shrink-0">
            <span class="rounded-full bg-neutral-100/10 px-3 py-1 text-white"
                >{year}</span
            >
            <span class="rounded-full bg-neutral-100/10 p-2 text-white">
                {
                    isExternal ? (
                        <Icon name="ph:arrow-up-right-bold" class="text-white" />
                    ) : (
                        <Icon name="ph:arrows-out-bold" class="text-white" />
                    )
                }
            </span>
        </div>
        <div class="thumbnail-container flex-1 flex-center">
            {
                thumbnail ? (
                    <img
                        src={thumbnail}
                        alt={title}
                        class="h-full object-contain"
                        style={
                            thumbnailWidth
                                ? `width: ${thumbnailWidth}`
                                : "width: 30%"
                        }
                    />
                ) : (
                    <span class="text-neutral-500">–</span>
                )
            }
        </div>
        <div class="shrink-0 text-white transition-transform duration-300 md:group-hover:-translate-y-6">
            <h3>{title}</h3>
            {tags && tags.length > 0 && (
                <div class="flex flex-wrap gap-1 mt-2">
                    {tags.map((tag) => (
                        <span class="text-xs bg-neutral-100/10 px-2 py-0.5 rounded-full opacity-70">
                            {tag}
                        </span>
                    ))}
                </div>
            )}
            <p class="hidden md:block max-h-0 overflow-hidden opacity-0 group-hover:max-h-24 group-hover:opacity-70 mt-2 transition-all duration-300">{description}</p>
        </div>
    </a>
)}

<style>
    .project-card {
        background-color: var(--bg-color);
    }

    :global([data-theme="dark"]) .project-card {
        background-color: var(--bg-color-dark);
    }
</style>
