---

---

<button
    id="theme-switcher"
    class="p-2 cursor-pointer"
    aria-label="Toggle theme"
>
    <div
        class="theme-icon h-4 w-4 bg-foreground rounded-full"
        data-theme-icon="light"
    >
    </div>
    <div
        class="theme-icon h-4 w-4 bg-foreground rounded-full hidden"
        data-theme-icon="dark"
    >
    </div>
    <div
        class="theme-icon h-4 w-4 hidden"
        data-theme-icon="teletext"
    >
        <svg viewBox="0 0 16 16" class="fill-foreground">
            <rect
                x="0"
                y="2"
                width="16"
                height="11"
                fill="none"
                stroke="currentColor"
                stroke-width="1"></rect>
            <rect x="2" y="4" width="12" height="7" fill="currentColor"></rect>
            <rect x="7" y="13" width="2" height="1" fill="currentColor"></rect>
            <rect x="5" y="14" width="6" height="1" fill="currentColor"></rect>
        </svg>
    </div>
</button>

<script>
    function initThemeSwitcher() {
        const button = document.getElementById("theme-switcher");
        if (!button) return;

        const themes = [null, "dark", "teletext"] as const;
        type Theme = (typeof themes)[number];

        function getStoredTheme(): Theme {
            const stored = localStorage.getItem("theme");
            if (stored === "dark" || stored === "teletext") return stored;
            return null;
        }

        function setTheme(theme: Theme) {
            if (theme) {
                document.documentElement.dataset.theme = theme;
                localStorage.setItem("theme", theme);
            } else {
                delete document.documentElement.dataset.theme;
                localStorage.removeItem("theme");
            }
            updateIcon(theme);
        }

        function updateIcon(theme: Theme) {
            const icons = button!.querySelectorAll(".theme-icon");
            icons.forEach((icon) => {
                const iconTheme = (icon as HTMLElement).dataset.themeIcon;
                if (
                    (theme === null && iconTheme === "light") ||
                    iconTheme === theme
                ) {
                    icon.classList.remove("hidden");
                } else {
                    icon.classList.add("hidden");
                }
            });
        }

        function cycleTheme() {
            const current = getStoredTheme();
            const currentIndex = themes.indexOf(current);
            const nextIndex = (currentIndex + 1) % themes.length;
            setTheme(themes[nextIndex]);
        }

        // Initialize with stored theme
        const storedTheme = getStoredTheme();
        setTheme(storedTheme);

        // Handle click - only add listener once per button instance
        if (!button.dataset.initialized) {
            button.dataset.initialized = "true";
            button.addEventListener("click", cycleTheme);
        }
    }

    // For view transitions (navigation between pages)
    document.addEventListener("astro:page-load", initThemeSwitcher);

    // For direct page loads - run immediately if DOM is ready
    if (document.readyState !== "loading") {
        initThemeSwitcher();
    }
</script>
