---
import { Icon } from "astro-icon/components";
import type { Book } from "@api/github-books";

interface Props {
    book: Book;
}

const { book } = Astro.props;

const formatDate = (dateString: string | null) => {
    if (!dateString) return "";
    const date = new Date(dateString);
    return date.toLocaleDateString("en-US", {
        month: "short",
        day: "2-digit",
    });
};

// Generate stars for rating
const rating = book.rating ?? 0;
const fullStars = Math.floor(rating);
const hasHalfStar = rating % 1 >= 0.5;
const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);

// Format authors
const authors = book.author.join(", ");
---

<div
    class="list-item-image-hover-effect group relative flex flex-col justify-between gap-4 border-b border-neutral-300 py-4 md:flex-row md:gap-12 md:py-10"
>
    {
        book.cover && (
            <img
                class="cover-image pointer-events-none absolute z-10 hidden max-w-40 shadow-lg md:group-hover:block"
                src={book.cover}
                alt={`${book.title} cover`}
                width="160"
                height="240"
                loading="lazy"
            />
        )
    }
    <div class="flex items-start justify-between gap-10 md:items-center">
        <div class="hidden shrink-0 font-mono md:block">
            {formatDate(book.finished)}
        </div>
        <div class="flex flex-col">
            <p class="flex flex-col text-base font-bold">
                {book.title}
            </p>
            <p class="text-sm text-neutral-500">
                {authors}
            </p>
        </div>
    </div>
    <div class="flex items-center gap-3">
        <div class="font-mono text-neutral-400 md:hidden">
            {formatDate(book.finished)}
        </div>
        {rating > 0 && <div class="font-mono text-neutral-400 md:hidden">|</div>}
        <div class="flex items-center gap-3">
            {
                rating > 0 && (
                    <div class="flex items-center gap-2">
                        <span class="mt-1 text-right font-mono text-2xs text-neutral-800 md:min-w-11">
                            ({rating})
                        </span>
                        <div class="flex items-center">
                            {Array.from({ length: fullStars }, (_, i) => (
                                <Icon name="ph:star-fill" width={16} />
                            ))}
                            {hasHalfStar && (
                                <Icon name="ph:star-half-fill" width={16} />
                            )}
                            {Array.from({ length: emptyStars }, (_, i) => (
                                <Icon
                                    name="ph:star-fill"
                                    width={16}
                                    class="text-neutral-300"
                                />
                            ))}
                        </div>
                    </div>
                )
            }
        </div>
    </div>
</div>
