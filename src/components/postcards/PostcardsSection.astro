---
import { db, Postcard, desc, eq } from "astro:db";
import { Icon } from "astro-icon/components";
import Link from "../Link.astro";
import PostcardsCarousel from "./PostcardsCarousel.astro";
import Container from "../Container.astro";

export interface Props {
    limit?: number | null;
    postcards?: (typeof Postcard.$inferSelect)[];
}

const { limit = null, postcards } = Astro.props;

let recentPostcards;

// If postcards are provided as prop, use them (with optional limit)
if (postcards) {
    recentPostcards = limit ? postcards.slice(0, limit) : postcards;
} else {
    // Otherwise, fetch from database (backward compatibility)
    let query = db
        .select()
        .from(Postcard)
        .where(eq(Postcard.isPublished, true))
        .orderBy(desc(Postcard.date));

    recentPostcards = limit ? await query.limit(limit) : await query;
}
---

{
    recentPostcards.length > 0 && (
        <div>
            <Container class="relative">
                <a
                    href="/postcards/new"
                    class="inline-flex items-center gap-2 absolute right-0 -top-10 hover-lift"
                >
                    <Icon name="new-postcard" size={100} />
                </a>
            </Container>
            <PostcardsCarousel postcards={recentPostcards} />
        </div>
    )
}
