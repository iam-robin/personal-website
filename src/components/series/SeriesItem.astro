---
import { Icon } from "astro-icon/components";
import type { Series } from "@api/github-series";

interface Props {
    series: Series;
    status?: "watching" | "paused";
}

const { series, status } = Astro.props;

const formatDate = (dateString: string | null) => {
    if (!dateString) return "";
    const date = new Date(dateString);
    return date.toLocaleDateString("en-US", {
        month: "short",
        day: "2-digit",
    });
};

// Generate stars for rating
const rating = series.rating ?? 0;
const fullStars = Math.floor(rating);
const hasHalfStar = rating % 1 >= 0.5;
const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);

// Format title with season
const displayTitle = series.season
    ? `${series.title} (${series.season})`
    : series.title;
---

<div
    class="list-item-image-hover-effect group relative flex flex-col justify-between gap-4 border-b border-neutral-300 py-4 md:flex-row md:gap-12 md:py-10"
>
    {
        series.cover && (
            <img
                class="cover-image pointer-events-none absolute z-10 hidden max-w-40 shadow-lg md:group-hover:block"
                src={series.cover}
                alt={`${series.title} poster`}
                width="160"
                height="240"
                loading="lazy"
            />
        )
    }
    <div class="flex items-start justify-between gap-10 md:items-center">
        <div class="hidden font-mono md:block shrink-0">
            {formatDate(series.finished)}
        </div>
        <p class="text-base flex flex-col font-bold">
            {displayTitle}
        </p>
    </div>
    <div class="flex items-center gap-3">
        <div class="font-mono text-neutral-400 md:hidden">
            {formatDate(series.finished)}
        </div>
        {series.finished && <div class="font-mono text-neutral-400 md:hidden">|</div>}
        <div class="flex items-center gap-2">
            {
                status === "watching" && (
                    <span class="bg-green-100 text-green-700 px-1.5 py-0.5 rounded text-xs">
                        watching
                    </span>
                )
            }
            {
                status === "paused" && (
                    <span class="bg-yellow-100 text-yellow-700 px-1.5 py-0.5 rounded text-xs">
                        paused
                    </span>
                )
            }
        </div>
        <div class="flex items-center gap-3">
            {
                rating > 0 && (
                    <div class="flex items-center gap-2">
                        <span class="text-2xs font-mono text-neutral-800 md:min-w-11 text-right mt-1">
                            ({rating})
                        </span>
                        <div class="flex items-center">
                            {Array.from({ length: fullStars }, (_, i) => (
                                <Icon name="ph:star-fill" width={16} />
                            ))}
                            {hasHalfStar && (
                                <Icon name="ph:star-half-fill" width={16} />
                            )}
                            {Array.from({ length: emptyStars }, (_, i) => (
                                <Icon
                                    name="ph:star-fill"
                                    width={16}
                                    class="text-neutral-300"
                                />
                            ))}
                        </div>
                    </div>
                )
            }
        </div>
    </div>
</div>
