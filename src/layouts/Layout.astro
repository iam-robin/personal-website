---
import "../styles/global.css";
import { ClientRouter } from "astro:transitions";
import Header from "../components/navigation/Header.astro";
import Footer from "@components/Footer.astro";

interface Props {
    hasHeader?: boolean;
    title?: string;
    description?: string;
    ogImage?: string;
}

const {
    hasHeader = true,
    title,
    description,
    ogImage = "/opengraph/opengraph.jpg",
} = Astro.props;

const siteUrl = Astro.url.origin;
const fullOgImageUrl = new URL(ogImage, siteUrl).toString();
const pageTitle = title ? `${title} | iamrobin` : "iamrobin";
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/apple-touch-icon.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="/favicon-32x32.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="/favicon-16x16.png"
        />
        <link rel="manifest" href="/site.webmanifest" />
        <meta name="generator" content={Astro.generator} />
        <title>{pageTitle}</title>
        {description && <meta name="description" content={description} />}
        <meta property="og:title" content={pageTitle} />
        <meta property="og:image" content={fullOgImageUrl} />
        <meta property="og:type" content="website" />
        {description && <meta property="og:description" content={description} />}
        <meta name="twitter:card" content="summary_large_image" />
        <ClientRouter />
        <!-- Privacy-friendly analytics by Plausible -->
        <script async src="https://plausible.io/js/pa-tf4WN8_9YDKt6QGrGPw7z.js"
        ></script>
        <script is:inline>
            ((window.plausible =
                window.plausible ||
                function () {
                    (plausible.q = plausible.q || []).push(arguments);
                }),
                (plausible.init =
                    plausible.init ||
                    function (i) {
                        plausible.o = i || {};
                    }));
            plausible.init();
        </script>

        <script is:inline>
            // Mark that JS is enabled (for graceful degradation)
            document.documentElement.classList.add("js");

            // Apply theme immediately to prevent flash on initial load
            (function () {
                const theme = localStorage.getItem("theme");
                if (theme === "dark") {
                    document.documentElement.dataset.theme = theme;
                }
            })();

            // Preserve theme during View Transitions
            document.addEventListener("astro:before-swap", (e) => {
                const theme = localStorage.getItem("theme");
                if (theme === "dark") {
                    e.newDocument.documentElement.dataset.theme = theme;
                }
            });
        </script>
    </head>
    <body class="bg-background text-foreground">
        {hasHeader && <Header />}
        <slot />
        <Footer class="mt-32" />
    </body>
</html>
