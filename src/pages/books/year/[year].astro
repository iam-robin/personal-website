---
import BooksPage from "@components/books/BooksPage.astro";
import { fetchBooks } from "@api/github-books";

export async function getStaticPaths() {
    const booksData = await fetchBooks();
    const { abgeschlossen, merkliste, aktiv } = booksData;

    // Get all years from completed books
    const abgeschlossenYears = Object.keys(abgeschlossen);

    // Add current year if there are aktiv books but no completed books for this year
    const currentYear = new Date().getFullYear().toString();
    const hasCurrentYearBooks = abgeschlossenYears.includes(currentYear);
    const years = hasCurrentYearBooks || aktiv.length === 0
        ? abgeschlossenYears
        : [currentYear, ...abgeschlossenYears];

    // Create paths for each year + want-to-read
    const paths = [
        ...years.map((year) => ({
            params: { year },
            props: { year, booksData },
        })),
        ...(merkliste.length > 0
            ? [
                  {
                      params: { year: "want-to-read" },
                      props: { year: "want-to-read", booksData },
                  },
              ]
            : []),
    ];

    return paths;
}

const { year, booksData } = Astro.props;
---

<BooksPage booksData={booksData} selectedYear={year} />
